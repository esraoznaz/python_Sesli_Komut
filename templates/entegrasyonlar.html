{% extends "base.html" %}

{% block title %}Entegrasyonlar{% endblock %}

{% block content %}
<h1>ğŸ”— Entegrasyonlar</h1>

<div id="voice-control-section">
    <h2>ğŸ™ï¸ Sesli Komutlar</h2>
    <p>Spotify veya E-posta entegrasyonunu sesli komutlarla yÃ¶netebilirsiniz.</p>
    <button onclick="startVoiceCommand()">Sesli Komut BaÅŸlat</button>
    <p id="command-output">Verilen komut: <span id="command-text">Bekleniyor...</span></p>
</div>

<div id="integrations-section">
    <h2>ğŸ”§ Mevcut Entegrasyonlar</h2>
    <ul>
        <li>Spotify Entegrasyonu</li>
        <li>E-posta Entegrasyonu</li>
    </ul>
</div>

<div id="spotify-controls">
    <h2>ğŸµ Spotify Kontrolleri</h2>
    <ul>
        <li>Spotify AÃ§</li>
        <li>ÅarkÄ±yÄ± BaÅŸlat</li>
        <li>ÅarkÄ±yÄ± Durdur</li>
        <li>ÅarkÄ±yÄ± DeÄŸiÅŸtir</li>
    </ul>    
</div>
<div id="outlook-controls">
    <h2>ğŸ“§ Outlook Kontrolleri</h2>
    <ul>
        <li>Outlook AÃ§</li>
        <li>e-posta gÃ¶nder</li>
        <li>e-posta oku</li>
    </ul>    
</div>


<script>
    function startVoiceCommand() {
        const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
        recognition.lang = 'tr-TR';

        recognition.onstart = function() {
            document.getElementById('command-text').innerText = 'Dinleniyor...';
        };

        recognition.onresult = function(event) {
            const command = event.results[0][0].transcript;
            document.getElementById('command-text').innerText = command;
            processCommand(command);
        };

        recognition.onerror = function() {
            document.getElementById('command-text').innerText = 'Bir hata oluÅŸtu, lÃ¼tfen tekrar deneyin.';
        };

        recognition.start();
    }

    function processCommand(command) {
    if (command.includes('Spotify aÃ§')) {
        openSpotify();
    } else if (command.includes('ÅŸarkÄ±yÄ± baÅŸlat')) {
        playSpotify();
    } else if (command.includes('ÅŸarkÄ±yÄ± deÄŸiÅŸtir')) {
        nextTrackSpotify();
    } else if (command.includes('ÅŸarkÄ±yÄ± durdur')) {
        pauseSpotify();
    } else if (command.includes('Ã§alma listesini deÄŸiÅŸtir')) {
        changePlaylistSpotify();
    } else if (command.toLowerCase().includes('outlook aÃ§')) {  // 'outlook aÃ§' komutunun kÃ¼Ã§Ã¼k harflerle kontrolÃ¼
        openOutlook();
    } else if (command.toLowerCase().includes('e-posta gÃ¶nder')) {
        sendEmail();
    } else if (command.toLowerCase().includes('e-posta oku')) {
        readEmail();
    } else {
        alert('Komut anlaÅŸÄ±lamadÄ±: ' + command);
    }
    }

    function openSpotify() {
        window.location.href = "spotify:";
    }

    function playSpotify() {
        fetch('/start-song')
            .then(response => response.json())
            .then(data => alert(data.message));
    }

    function pauseSpotify() {
        fetch('/pause-song')
            .then(response => response.json())
            .then(data => alert(data.message));
    }

    function nextTrackSpotify() {
        fetch('/next-song')
            .then(response => response.json())
            .then(data => alert(data.message));
    }

    function openOutlook() {
        fetch('/open-outlook')
            .then(response => response.json())
            .then(data => alert(data.message));
    }

    function sendEmail() {
    const recipient = prompt("E-posta alÄ±cÄ±sÄ±nÄ± girin:");
    const subject = prompt("E-posta konusunu girin:");
    const body = prompt("E-posta iÃ§eriÄŸini girin:");

    fetch('/send-email', {
        method: 'POST',
        body: new URLSearchParams({
            'to': recipient,
            'subject': subject,
            'body': body
        })
    })
    .then(response => response.json())
    .then(data => alert(data.response));
    }

    function readEmail() {
    fetch('/read-email')
        .then(response => response.json())
        .then(data => alert(data.response));
    }
</script>

{% endblock %}
