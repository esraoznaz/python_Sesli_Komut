{% extends "base.html" %}

{% block title %}Sesli Komut{% endblock %}

{% block content %}
<h1>ğŸ¤ Sesli Komut</h1>

<h2>ğŸ™ï¸ Sesli Komutlar</h2>
    <p>Bilgisayar ayarlarÄ±nÄ± sesli komutlarla yÃ¶netebilirsiniz.</p>

<!-- Sesli komut butonu ve durum mesajÄ± -->
<button id="start-button">Sesli Komut BaÅŸlat</button>
<p id="status"></p>

<div id="spotify-controls">
    <h2>ğŸ™ï¸ Sesli Komut Kontrolleri</h2>
    <ul>
        <li>Sesi aÃ§</li>
        <li>Sesi kÄ±s</li>
        <li>ParlaklÄ±ÄŸÄ± azalt</li>
        <li>ParlaklÄ±ÄŸÄ± arttÄ±r</li>
    </ul>    
</div>

<script>
    // Web Speech API ile sesli komut almayÄ± saÄŸlayan iÅŸlev
    const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
    recognition.lang = 'tr-TR';  // TÃ¼rkÃ§e dil desteÄŸi
    recognition.interimResults = false;  // Sadece sonucun gelmesini bekle
    recognition.maxAlternatives = 1;  // Sadece 1 alternatif komut dÃ¶ndÃ¼r

    // Sesli komut butonuna tÄ±klama iÅŸlemi
    document.getElementById("start-button").addEventListener("click", function() {
        // Mikrofonu aÃ§ ve sesli komut al
        recognition.start();
        
        // Sesli komut baÅŸladÄ±ÄŸÄ±nda durum mesajÄ± gÃ¼ncelle
        document.getElementById("status").innerText = "Dinleniyor...";

        recognition.onresult = function(event) {
            const command = event.results[0][0].transcript.toLowerCase();  // AlÄ±nan komut

            // Flask ile sesli komut iÅŸlemi baÅŸlatÄ±lÄ±yor
            fetch('/voice-command', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ command: command })  // Komut JSON formatÄ±nda gÃ¶nderiliyor
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById("status").innerText = data.message;
            })
            .catch(error => {
                document.getElementById("status").innerText = "Bir hata oluÅŸtu!";
                console.error('Error:', error);
            });
        };

        recognition.onerror = function(event) {
            document.getElementById("status").innerText = "Bir hata oluÅŸtu!";
            console.error('Error:', event.error);
        };
    });
</script>

{% endblock %}
